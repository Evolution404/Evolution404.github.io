<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="MAC下安装配置树莓派系统"><meta name="keywords" content><meta name="author" content="zhang Yuxi"><meta name="copyright" content="zhang Yuxi"><title>Evolution</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装系统"><span class="toc-number">1.</span> <span class="toc-text">安装系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载镜像"><span class="toc-number">1.1.</span> <span class="toc-text">下载镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装镜像"><span class="toc-number">1.2.</span> <span class="toc-text">安装镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用Etcher安装"><span class="toc-number">1.2.1.</span> <span class="toc-text">使用Etcher安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用命令行安装"><span class="toc-number">1.2.2.</span> <span class="toc-text">使用命令行安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#格式化硬盘"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">格式化硬盘</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#卸载分区"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">卸载分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#写入镜像"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">写入镜像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置wifi"><span class="toc-number">1.3.</span> <span class="toc-text">配置wifi</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开启ssh服务"><span class="toc-number">1.4.</span> <span class="toc-text">开启ssh服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置系统"><span class="toc-number">2.</span> <span class="toc-text">配置系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#支持中文"><span class="toc-number">2.1.</span> <span class="toc-text">支持中文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建用户修改密码"><span class="toc-number">2.2.</span> <span class="toc-text">创建用户修改密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建用户"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改密码"><span class="toc-number">2.2.2.</span> <span class="toc-text">修改密码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装proxychains"><span class="toc-number">2.3.</span> <span class="toc-text">安装proxychains</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用apt安装必要的库"><span class="toc-number">2.4.</span> <span class="toc-text">使用apt安装必要的库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译安装vim"><span class="toc-number">2.5.</span> <span class="toc-text">编译安装vim</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#硬盘相关"><span class="toc-number">2.6.</span> <span class="toc-text">硬盘相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#挂载"><span class="toc-number">2.6.1.</span> <span class="toc-text">挂载</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#挂载硬盘"><span class="toc-number">2.6.1.1.</span> <span class="toc-text">挂载硬盘</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#自动挂载"><span class="toc-number">2.6.1.2.</span> <span class="toc-text">自动挂载</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试硬盘读写速度"><span class="toc-number">2.6.2.</span> <span class="toc-text">测试硬盘读写速度</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#测试写入速度"><span class="toc-number">2.6.2.1.</span> <span class="toc-text">测试写入速度</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#测试读取速度"><span class="toc-number">2.6.2.2.</span> <span class="toc-text">测试读取速度</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#备份与恢复"><span class="toc-number">2.7.</span> <span class="toc-text">备份与恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#备份"><span class="toc-number">2.7.1.</span> <span class="toc-text">备份</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#恢复"><span class="toc-number">2.7.2.</span> <span class="toc-text">恢复</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#网络相关问题"><span class="toc-number">2.8.</span> <span class="toc-text">网络相关问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看网口的速度"><span class="toc-number">2.8.1.</span> <span class="toc-text">查看网口的速度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看当前连接的wifi"><span class="toc-number">2.8.2.</span> <span class="toc-text">查看当前连接的wifi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#扫描所有wifi"><span class="toc-number">2.8.3.</span> <span class="toc-text">扫描所有wifi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5G频段wifi搜索不到的问题"><span class="toc-number">2.8.4.</span> <span class="toc-text">5G频段wifi搜索不到的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义命令"><span class="toc-number">2.9.</span> <span class="toc-text">自定义命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#temp命令"><span class="toc-number">2.9.1.</span> <span class="toc-text">temp命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CPU压力测试"><span class="toc-number">2.9.2.</span> <span class="toc-text">CPU压力测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置透明网关"><span class="toc-number">2.10.</span> <span class="toc-text">配置透明网关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装v2ray和ipset"><span class="toc-number">2.10.1.</span> <span class="toc-text">安装v2ray和ipset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改v2ray配置文件"><span class="toc-number">2.10.2.</span> <span class="toc-text">修改v2ray配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置透明代理规则并开机自动运行"><span class="toc-number">2.10.3.</span> <span class="toc-text">设置透明代理规则并开机自动运行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解决访问慢问题"><span class="toc-number">2.10.4.</span> <span class="toc-text">解决访问慢问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置网关"><span class="toc-number">2.10.5.</span> <span class="toc-text">设置网关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#在路由器上直接设置"><span class="toc-number">2.10.5.1.</span> <span class="toc-text">在路由器上直接设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#设置MAC的默认网关"><span class="toc-number">2.10.5.2.</span> <span class="toc-text">设置MAC的默认网关</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#设置手机等的默认网关"><span class="toc-number">2.10.5.3.</span> <span class="toc-text">设置手机等的默认网关</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#根据订阅地址自动更新节点"><span class="toc-number">2.10.6.</span> <span class="toc-text">根据订阅地址自动更新节点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#创建python文件并设置权限"><span class="toc-number">2.10.6.1.</span> <span class="toc-text">创建python文件并设置权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#使用systemd配置开机启动"><span class="toc-number">2.10.6.2.</span> <span class="toc-text">使用systemd配置开机启动</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一键配置系统脚本"><span class="toc-number">3.</span> <span class="toc-text">一键配置系统脚本</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://gitee.com/Evolution404/picgo-img/raw/master/20191026181121-HBhrfe.jpg"></div><div class="author-info__name text-center">zhang Yuxi</div><div class="author-info__description text-center">It is not our abilities that show what we truly are , it is our choices</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">91</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">27</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">20</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://evolution404.gitee.io/markdownimg/20190513125446.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Evolution</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a><a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span></div><div id="post-info"><div id="post-title">MAC下安装配置树莓派系统</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-01-08<span class="post-meta__separator">|</span><i class="fa fa-calendar-check-o" aria-hidden="true"></i> 更新于 2021-04-30</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/RaspberryPi/">RaspberryPi</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 19 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h2><h3 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h3><p><a href="https://www.raspberrypi.org/downloads/raspbian/" target="_blank" rel="noopener">官网下载</a><br>其中分别是完整版,桌面版去掉一些软件,以及Lite轻量版只有命令行界面不包括桌面</p>
<h3 id="安装镜像"><a href="#安装镜像" class="headerlink" title="安装镜像"></a>安装镜像</h3><p>安装镜像有两种方式</p>
<h4 id="使用Etcher安装"><a href="#使用Etcher安装" class="headerlink" title="使用Etcher安装"></a>使用Etcher安装</h4><p><a href="https://www.balena.io/etcher/" target="_blank" rel="noopener">下载Etcher</a></p>
<h4 id="使用命令行安装"><a href="#使用命令行安装" class="headerlink" title="使用命令行安装"></a>使用命令行安装</h4><h5 id="格式化硬盘"><a href="#格式化硬盘" class="headerlink" title="格式化硬盘"></a>格式化硬盘</h5><p>使用磁盘工具(Disk Utility)格式化SD卡,使用FAT格式点击抹掉(Erase)<br>或者使用<code>SD Card Formatter</code>格式化SD卡</p>
<h5 id="卸载分区"><a href="#卸载分区" class="headerlink" title="卸载分区"></a>卸载分区</h5><ol>
<li>首先执行<code>df -h</code>查看SD卡的分区名</li>
<li>执行<code>diskutil unmount 分区名</code>卸载分区</li>
</ol>
<h5 id="写入镜像"><a href="#写入镜像" class="headerlink" title="写入镜像"></a>写入镜像</h5><ol>
<li>执行<code>diskutil list</code>查看分区名<br><img src="https://gitee.com/Evolution404/picgo-img/raw/master/20200108202351-llkJ6x.png" alt></li>
<li>执行<code>sudo dd bs=4m if=xxxx.img of=分区名</code>写入镜像</li>
</ol>
<h3 id="配置wifi"><a href="#配置wifi" class="headerlink" title="配置wifi"></a>配置wifi</h3><ol>
<li>在<code>boot</code>目录下创建<code>wpa_supplicant.conf</code>文件</li>
<li>写入wifi信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">country=CN</span><br><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">update_config=1</span><br><span class="line"> </span><br><span class="line">network=&#123;</span><br><span class="line">  ssid=&quot;WiFi-A&quot;</span><br><span class="line">  psk=&quot;12345678&quot;</span><br><span class="line">  key_mgmt=WPA-PSK</span><br><span class="line">  priority=1</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">network=&#123;</span><br><span class="line">  ssid=&quot;WiFi-B&quot;</span><br><span class="line">  psk=&quot;12345678&quot;</span><br><span class="line">  key_mgmt=WPA-PSK</span><br><span class="line">  priority=2</span><br><span class="line">  scan_ssid=1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ssid:wifi名称<br>psk:wifi密码<br>key_mgmt:加密方式<br>priority:连接优先级,越大优先级越高<br>scan_ssid:如果是隐藏wifi需要设置该项</p>
<h3 id="开启ssh服务"><a href="#开启ssh服务" class="headerlink" title="开启ssh服务"></a>开启ssh服务</h3><p>在boot目录下创建<code>ssh</code>文件,执行<code>touch ssh</code>即可</p>
<h2 id="配置系统"><a href="#配置系统" class="headerlink" title="配置系统"></a>配置系统</h2><h3 id="支持中文"><a href="#支持中文" class="headerlink" title="支持中文"></a>支持中文</h3><ol>
<li>sudo raspi-config</li>
<li>选择Localisation Options</li>
<li>选择Change Locale</li>
<li>去掉<code>en_GB.UTF-8 UTF-8</code>,选择<code>en_US.UTF-8 UTF-8</code></li>
</ol>
<h3 id="创建用户修改密码"><a href="#创建用户修改密码" class="headerlink" title="创建用户修改密码"></a>创建用户修改密码</h3><h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adduser nas</span><br></pre></td></tr></table></figure>
<h4 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h4><p>使用passwd命令</p>
<h3 id="安装proxychains"><a href="#安装proxychains" class="headerlink" title="安装proxychains"></a>安装proxychains</h3><ol>
<li>执行<code>sudo apt install proxychains</code></li>
<li>修改配置文件<code>/etc/proxychains.conf</code></li>
<li>设置为socket5,配置对应的ip和端口</li>
</ol>
<h3 id="使用apt安装必要的库"><a href="#使用apt安装必要的库" class="headerlink" title="使用apt安装必要的库"></a>使用apt安装必要的库</h3><ol>
<li><code>sudo proxychains apt update</code></li>
<li><code>sudo proxychains apt upgrade</code></li>
<li><code>sudo proxychains apt install ncurses-dev</code></li>
</ol>
<h3 id="编译安装vim"><a href="#编译安装vim" class="headerlink" title="编译安装vim"></a>编译安装vim</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxychains git <span class="built_in">clone</span> https://github.com/vim/vim.git</span><br><span class="line"><span class="built_in">cd</span> vim</span><br><span class="line">./configure --with-features=huge --<span class="built_in">enable</span>-multibyte --<span class="built_in">enable</span>-python3interp=yes --with-python-config-dir=/usr/lib/python3.7/config-3.7m-arm-linux-gnueabihf --<span class="built_in">enable</span>-cscope --prefix=/usr/<span class="built_in">local</span></span><br><span class="line">sudo make -j4 &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>
<h3 id="硬盘相关"><a href="#硬盘相关" class="headerlink" title="硬盘相关"></a>硬盘相关</h3><h4 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h4><h5 id="挂载硬盘"><a href="#挂载硬盘" class="headerlink" title="挂载硬盘"></a>挂载硬盘</h5><ol>
<li>首先插上硬盘,执行<code>sudo fdisk -l</code>查看硬盘的名字<br><img src="https://gitee.com/Evolution404/picgo-img/raw/master/uPic/hQLuFP.png" alt></li>
<li>执行<code>sudo mount /dev/sda1 /home/nas</code>挂载硬盘,<code>/home/nas</code>是挂载的目标目录,需要提前创建</li>
</ol>
<h5 id="自动挂载"><a href="#自动挂载" class="headerlink" title="自动挂载"></a>自动挂载</h5><ol>
<li>修改<code>/etc/fstab</code>文件 添加<code>/dev/sda1  /home/nas ext4 defaults,nofail,x-systemd.device-timeout=5,noatime 0 0</code></li>
<li><code>nofail</code>选项避免未检测到硬盘后无法启动</li>
<li><code>x-systemd.device-timeout</code>代表未检测到硬盘后的等待时间,默认为90s太长了,这里修改为5s</li>
<li><code>noatime</code>代表不记录最后访问时间等,提高文件系统的效率</li>
<li><a href="https://wiki.archlinux.org/index.php/Fstab#File_system_labels" target="_blank" rel="noopener">fstab文件的详细信息</a></li>
</ol>
<h4 id="测试硬盘读写速度"><a href="#测试硬盘读写速度" class="headerlink" title="测试硬盘读写速度"></a>测试硬盘读写速度</h4><h5 id="测试写入速度"><a href="#测试写入速度" class="headerlink" title="测试写入速度"></a>测试写入速度</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=tmp.data bs=1000M count=1</span><br></pre></td></tr></table></figure>
<h5 id="测试读取速度"><a href="#测试读取速度" class="headerlink" title="测试读取速度"></a>测试读取速度</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo hdparm -Tt /dev/sda</span><br></pre></td></tr></table></figure>
<h3 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h3><h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不压缩</span></span><br><span class="line">sudo dd bs=4M <span class="keyword">if</span>=/dev/mmcblk0 status=progress of=raspbian.img</span><br><span class="line"><span class="comment"># 压缩</span></span><br><span class="line">wget https://raw.githubusercontent.com/Drewsif/PiShrink/master/pishrink.sh</span><br><span class="line">sudo dd bs=4M <span class="keyword">if</span>=/dev/mmcblk0 status=progress of=raspbian.img</span><br><span class="line">sudo bash pishrink.sh -z raspbian.img</span><br></pre></td></tr></table></figure>
<h4 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h4><p>直接使用<code>Etcher</code>写入镜像即可</p>
<h3 id="网络相关问题"><a href="#网络相关问题" class="headerlink" title="网络相关问题"></a>网络相关问题</h3><h4 id="查看网口的速度"><a href="#查看网口的速度" class="headerlink" title="查看网口的速度"></a>查看网口的速度</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ethtool eth0</span><br></pre></td></tr></table></figure>
<h4 id="查看当前连接的wifi"><a href="#查看当前连接的wifi" class="headerlink" title="查看当前连接的wifi"></a>查看当前连接的wifi</h4><p><code>iw wlan0 link</code></p>
<h4 id="扫描所有wifi"><a href="#扫描所有wifi" class="headerlink" title="扫描所有wifi"></a>扫描所有wifi</h4><p><code>sudo iw wlan0 scan</code></p>
<h4 id="5G频段wifi搜索不到的问题"><a href="#5G频段wifi搜索不到的问题" class="headerlink" title="5G频段wifi搜索不到的问题"></a>5G频段wifi搜索不到的问题</h4><ol>
<li>执行<code>sudo raspi-config</code></li>
<li>选择<code>Localisation Options</code></li>
<li>选择<code>Change Wi-fi Country</code></li>
<li>选择<code>US</code></li>
</ol>
<h3 id="自定义命令"><a href="#自定义命令" class="headerlink" title="自定义命令"></a>自定义命令</h3><h4 id="temp命令"><a href="#temp命令" class="headerlink" title="temp命令"></a>temp命令</h4><p>用来查看CPU温度<br>在<code>~/.bashrc</code>中加入<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> temp=<span class="string">"awk '&#123;print \$1/1000\"C\"&#125;' /sys/class/thermal/thermal_zone0/temp"</span></span><br></pre></td></tr></table></figure></p>
<h4 id="CPU压力测试"><a href="#CPU压力测试" class="headerlink" title="CPU压力测试"></a>CPU压力测试</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /dev/urandom | md5sum</span><br></pre></td></tr></table></figure>
<p>这条命令可以占满一个核心,多个核心执行多次</p>
<h3 id="配置透明网关"><a href="#配置透明网关" class="headerlink" title="配置透明网关"></a>配置透明网关</h3><h4 id="安装v2ray和ipset"><a href="#安装v2ray和ipset" class="headerlink" title="安装v2ray和ipset"></a>安装v2ray和ipset</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 树莓派开启ip转发</span></span><br><span class="line"><span class="built_in">echo</span> net.ipv4.ip_forward=1 &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p</span><br><span class="line">wget https://install.direct/go.sh</span><br><span class="line">sudo bash go.sh</span><br><span class="line"><span class="comment"># 安装ipset</span></span><br><span class="line">sudo apt install ipset</span><br><span class="line"><span class="comment"># 启动v2ray</span></span><br><span class="line">sudo systemctl start v2ray</span><br></pre></td></tr></table></figure>
<h4 id="修改v2ray配置文件"><a href="#修改v2ray配置文件" class="headerlink" title="修改v2ray配置文件"></a>修改v2ray配置文件</h4><p>配置文件是<code>/etc/v2ray/config.json</code>,详细信息查看<a href="https://www.v2ray.com/index.html" target="_blank" rel="noopener">官方文档</a><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑配置文件命令</span></span><br><span class="line">sudo vim /etc/v2ray/config.json</span><br><span class="line"><span class="comment"># 测试配置文件语法命令</span></span><br><span class="line">/usr/bin/v2ray/v2ray -<span class="built_in">test</span> -config /etc/v2ray/config.json</span><br><span class="line"><span class="comment"># 测试能否访问谷歌的命令,10886就是inbounds中socks的端口</span></span><br><span class="line"><span class="comment"># 返回301或200说明能访问,无反应或是000说明不行</span></span><br><span class="line">curl -so /dev/null -w <span class="string">"%&#123;http_code&#125;"</span> google.com -x socks5://127.0.0.1:10886</span><br></pre></td></tr></table></figure></p>
<p>配置文件内容<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"log"</span>: &#123;</span><br><span class="line">    <span class="attr">"access"</span>: <span class="string">"/var/log/v2ray/access.log"</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"/var/log/v2ray/error.log"</span>,</span><br><span class="line">    <span class="attr">"loglevel"</span>: <span class="string">"none"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"transparent"</span>,</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">12345</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"dokodemo-door"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"network"</span>: <span class="string">"tcp,udp"</span>,</span><br><span class="line">        <span class="attr">"followRedirect"</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">        <span class="attr">"sockopt"</span>: &#123;</span><br><span class="line">          <span class="attr">"tproxy"</span>: <span class="string">"tproxy"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"domainStrategy"</span>: <span class="string">"UseIPv4"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">        <span class="attr">"sockopt"</span>: &#123;</span><br><span class="line">          <span class="attr">"mark"</span>: <span class="number">255</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改后执行<code>sudo systemctl restart v2ray</code>重新加载配置文件</p>
<h4 id="设置透明代理规则并开机自动运行"><a href="#设置透明代理规则并开机自动运行" class="headerlink" title="设置透明代理规则并开机自动运行"></a>设置透明代理规则并开机自动运行</h4><p>新建脚本<code>ip.sh</code><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Destroy ipset if it already exists</span></span><br><span class="line">systemctl stop ipset</span><br><span class="line">ipset destroy china</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the ipset list</span></span><br><span class="line">ipset -N china <span class="built_in">hash</span>:net</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove any old list that might exist from previous runs of this script</span></span><br><span class="line">rm cn.zone</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pull the latest IP set for China</span></span><br><span class="line">wget -P . http://www.ipdeny.com/ipblocks/data/countries/cn.zone</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add each IP address from the downloaded list into the ipset 'china'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(cat ./cn.zone ); <span class="keyword">do</span> ipset -A china <span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line">rm cn.zone</span><br><span class="line"></span><br><span class="line">mkdir -p /etc/ipset &amp;&amp; ipset -file /etc/ipset/ipset.conf save</span><br><span class="line">cat &gt; /etc/systemd/system/ipset.service &lt;&lt; <span class="string">'END_TEXT'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=ipset persistent rule service</span><br><span class="line">Before=tproxyrule.service</span><br><span class="line">ConditionFileNotEmpty=/etc/ipset/ipset.conf</span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">RemainAfterExit=<span class="literal">true</span></span><br><span class="line">ExecStart=/sbin/ipset -exist -file /etc/ipset/ipset.conf restore</span><br><span class="line">ExecStop=/sbin/ipset -file /etc/ipset/ipset.conf save</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">END_TEXT</span><br><span class="line">systemctl <span class="built_in">enable</span> ipset</span><br><span class="line"></span><br><span class="line">ip rule add fwmark 1 table 100</span><br><span class="line">ip route add <span class="built_in">local</span> 0.0.0.0/0 dev lo table 100</span><br><span class="line"></span><br><span class="line">iptables -F -t mangle</span><br><span class="line"><span class="comment"># 代理局域网设备</span></span><br><span class="line">iptables -t mangle -N V2RAY</span><br><span class="line">iptables -t mangle -A V2RAY -d 127.0.0.1/32 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY -d 224.0.0.0/4 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY -d 255.255.255.255/32 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY -d 192.168.0.0/16 -p tcp -j RETURN <span class="comment"># 直连局域网，避免 V2Ray 无法启动时无法连网关的 SSH，如果你配置的是其他网段（如 10.x.x.x 等），则修改成自己的</span></span><br><span class="line">iptables -t mangle -A V2RAY -d 192.168.0.0/16 -p udp ! --dport 53 -j RETURN <span class="comment"># 直连局域网，53 端口除外（因为要使用 V2Ray 的</span></span><br><span class="line">iptables -t mangle -A V2RAY -p tcp -m <span class="built_in">set</span> --match-set china dst -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY -p udp --dport 53 -j DROP -m mark --mark 0xff <span class="comment"># 这里丢弃发送到本机被标记了的udp 53端口流量,如果不丢弃会形成死循环</span></span><br><span class="line">iptables -t mangle -A V2RAY -p udp -j TPROXY --on-port 12345 --tproxy-mark 1 <span class="comment"># 给 UDP 打标记 1，转发至 12345 端口</span></span><br><span class="line">iptables -t mangle -A V2RAY -p tcp -j TPROXY --on-port 12345 --tproxy-mark 1 <span class="comment"># 给 TCP 打标记 1，转发至 12345 端口</span></span><br><span class="line">iptables -t mangle -A PREROUTING -j V2RAY <span class="comment"># 应用规则</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理网关本机</span></span><br><span class="line">iptables -t mangle -N V2RAY_MASK</span><br><span class="line">iptables -t mangle -A V2RAY_MASK -d 224.0.0.0/4 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY_MASK -d 255.255.255.255/32 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY_MASK -d 192.168.0.0/16 -p tcp -j RETURN <span class="comment"># 直连局域网</span></span><br><span class="line">iptables -t mangle -A V2RAY_MASK -p tcp -m <span class="built_in">set</span> --match-set china dst -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY_MASK -p udp --dport 53 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY_MASK -d 192.168.0.0/16 -p udp ! --dport 53 -j RETURN <span class="comment"># 直连局域网，53 端口除外（因为要使用 V2Ray 的 DNS）</span></span><br><span class="line"><span class="comment"># 这条命令使用的是RETURN,如果有发送到本机的udp 53端口流量经过这里发送出去后会重新进入上面的PREROUTING</span></span><br><span class="line">iptables -t mangle -A V2RAY_MASK -j RETURN -m mark --mark 0xff    <span class="comment"># 直连 SO_MARK 为 0xff 的流量(0xff 是 16 进制数，数值上等同与上面V2Ray 配置的 255)，此规则目的是避免代理本机(网关)流量出现回环问题</span></span><br><span class="line">iptables -t mangle -A V2RAY_MASK -p udp -j MARK --<span class="built_in">set</span>-mark 1   <span class="comment"># 给 UDP 打标记,重路由</span></span><br><span class="line">iptables -t mangle -A V2RAY_MASK -p tcp -j MARK --<span class="built_in">set</span>-mark 1   <span class="comment"># 给 TCP 打标记，重路由</span></span><br><span class="line">iptables -t mangle -A OUTPUT -j V2RAY_MASK <span class="comment"># 应用规则</span></span><br><span class="line">mkdir -p /etc/iptables &amp;&amp; iptables-save &gt; /etc/iptables/rules.v4</span><br><span class="line">cat &gt; /etc/systemd/system/tproxyrule.service &lt;&lt; <span class="string">'END_TEXT'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Tproxy rule</span><br><span class="line">After=network.target</span><br><span class="line">Wants=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"></span><br><span class="line">Type=oneshot</span><br><span class="line"><span class="comment">#注意分号前后要有空格</span></span><br><span class="line">ExecStart=/sbin/ip rule add fwmark 1 table 100 ; /sbin/ip route add <span class="built_in">local</span> 0.0.0.0/0 dev lo table 100 ; /sbin/iptables-restore /etc/iptables/rules.v4</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">END_TEXT</span><br><span class="line">systemctl <span class="built_in">enable</span> tproxyrule</span><br></pre></td></tr></table></figure></p>
<p>创建脚本后使用<code>sudo bash ip.sh</code>执行</p>
<h4 id="解决访问慢问题"><a href="#解决访问慢问题" class="headerlink" title="解决访问慢问题"></a>解决访问慢问题</h4><p>启动后一直报错<code>too many open files</code>,导致访问缓慢,特别是在域名解析时使用UDP协议<br><strong>解决方案</strong></p>
<ol>
<li>编辑<code>/etc/systemd/system/v2ray.service</code>文件,在<strong>[Service]</strong>下加入<code>LimitNPROC=500</code>和<code>LimitNOFILE=1000000</code>两行</li>
<li>执行<code>systemctl daemon-reload &amp;&amp; systemctl restart v2ray</code>生效</li>
</ol>
<h4 id="设置网关"><a href="#设置网关" class="headerlink" title="设置网关"></a>设置网关</h4><h5 id="在路由器上直接设置"><a href="#在路由器上直接设置" class="headerlink" title="在路由器上直接设置"></a>在路由器上直接设置</h5><p>在路由器的DHCP设置里修改默认网关为树莓派的ip即可</p>
<p>一些路由器不能设置默认网关所以各种设备需要单独设置</p>
<h5 id="设置MAC的默认网关"><a href="#设置MAC的默认网关" class="headerlink" title="设置MAC的默认网关"></a>设置MAC的默认网关</h5><p><strong>方法一</strong><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo route delete default &amp;&amp; sudo route add default 192.168.x.x</span><br></pre></td></tr></table></figure></p>
<p>这种方法容易失效</p>
<p><strong>方法二</strong></p>
<ol>
<li>Network Preferences</li>
<li>Advanced</li>
<li>修改TCP/IP设置为Manually填写Router设置为树莓派ip</li>
<li>修改DNS设置为树莓派地址</li>
</ol>
<h5 id="设置手机等的默认网关"><a href="#设置手机等的默认网关" class="headerlink" title="设置手机等的默认网关"></a>设置手机等的默认网关</h5><ol>
<li>设置ip地址静态分配</li>
<li>其中可能有路由器,route或者网关,这三种名称都代表网关,修改为树莓派的地址</li>
<li>修改默认DNS服务器为树莓派地址</li>
</ol>
<h4 id="根据订阅地址自动更新节点"><a href="#根据订阅地址自动更新节点" class="headerlink" title="根据订阅地址自动更新节点"></a>根据订阅地址自动更新节点</h4><h5 id="创建python文件并设置权限"><a href="#创建python文件并设置权限" class="headerlink" title="创建python文件并设置权限"></a>创建python文件并设置权限</h5><p>首先执行以下命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install pysocks colorlog</span><br><span class="line">sudo touch /usr/bin/v2ray_auto_change</span><br><span class="line">sudo chmod 777 /usr/bin/v2ray_auto_change</span><br><span class="line">sudo chmod -R 777 /var/<span class="built_in">log</span>/</span><br></pre></td></tr></table></figure></p>
<p>写入文件<code>/usr/bin/v2ray_auto_change</code>以下内容<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys,os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> colorlog</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> handlers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SUBSCRIBE_URL = <span class="string">'https://xbssr.fun/rss/v809dCv/I6SgUz?net_type=VMESS'</span></span><br><span class="line">SUBSCRIBE_RETRY_MAX = <span class="number">3</span>      <span class="comment"># 加载订阅信息最大尝试次数</span></span><br><span class="line">TEST_CONNECT_URL = <span class="string">'https://www.google.com/'</span></span><br><span class="line">TEST_CONNECT_TIMES = <span class="number">10</span>      <span class="comment"># 检测上面url的次数</span></span><br><span class="line">V2RAY_PATH = <span class="string">'/usr/bin/v2ray/v2ray'</span></span><br><span class="line">V2RAY_CONIG_FILE = <span class="string">'/etc/v2ray/config.json'</span></span><br><span class="line">LOG_FILE = <span class="string">'/var/log/v2ray/v2ray_auto_change.log'</span></span><br><span class="line">MAX_SERVER = <span class="number">30</span>              <span class="comment"># 最多同时检测多少个服务器</span></span><br><span class="line">LOG_COLORS_CONFIG = &#123;</span><br><span class="line">    <span class="string">'DEBUG'</span>: <span class="string">'cyan'</span>,</span><br><span class="line">    <span class="string">'INFO'</span>: <span class="string">'green'</span>,</span><br><span class="line">    <span class="string">'WARNING'</span>: <span class="string">'yellow'</span>,</span><br><span class="line">    <span class="string">'ERROR'</span>: <span class="string">'red'</span>,</span><br><span class="line">    <span class="string">'CRITICAL'</span>: <span class="string">'red'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间设置</span></span><br><span class="line">TIME_INTERVAL = <span class="number">3</span>           <span class="comment"># 多少秒循环检测一次当前服务器状态</span></span><br><span class="line">SUBSCRIBE_CACHE_TIME = <span class="number">1800</span>  <span class="comment"># 订阅信息缓存多少秒,超时后访问订阅地址重新获取</span></span><br><span class="line">SUBSCRIBE_TIMEOUT = <span class="number">10</span>       <span class="comment"># 获取订阅内容超时时间</span></span><br><span class="line">TEST_CONNECT_TIMEOUT = <span class="number">3</span>     <span class="comment"># 连接测试地址的超时时间</span></span><br><span class="line">TEST_READ_TIMEOUT = <span class="number">5</span>        <span class="comment"># 等待测试地址返回数据的超时时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 系数</span></span><br><span class="line">PERFECT_FACTOR = <span class="number">100</span></span><br><span class="line">LATENCY_FACTOR = <span class="number">100</span></span><br><span class="line">CHECK_LIMIT = <span class="number">2</span></span><br><span class="line">RESET_FACTOR_LIMIT = <span class="number">200</span>     <span class="comment"># 当前服务器系数达到该值寻找新的最优服务器</span></span><br><span class="line"></span><br><span class="line">TMP_CONFIG_FILE = <span class="string">'''</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "inbounds": [</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      "port": 1080,</span></span><br><span class="line"><span class="string">      "protocol": "socks",</span></span><br><span class="line"><span class="string">      "sniffing": &#123;</span></span><br><span class="line"><span class="string">        "enabled": true,</span></span><br><span class="line"><span class="string">        "destOverride": ["http", "tls"]</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      "settings": &#123;</span></span><br><span class="line"><span class="string">        "auth": "noauth"</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  "outbounds": [</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      "protocol": "vmess",</span></span><br><span class="line"><span class="string">      "settings": &#123;</span></span><br><span class="line"><span class="string">        "vnext": [</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">FINAL_CONFIG_FILE = <span class="string">'''</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "log": &#123;</span></span><br><span class="line"><span class="string">    "access": "/var/log/v2ray/access.log",</span></span><br><span class="line"><span class="string">    "error": "/var/log/v2ray/error.log",</span></span><br><span class="line"><span class="string">    "loglevel": "none"</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "inbounds": [</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      "tag":"transparent",</span></span><br><span class="line"><span class="string">      "port": 12345,</span></span><br><span class="line"><span class="string">      "protocol": "dokodemo-door",</span></span><br><span class="line"><span class="string">      "settings": &#123;</span></span><br><span class="line"><span class="string">        "network": "tcp,udp",</span></span><br><span class="line"><span class="string">        "followRedirect": true</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      "sniffing": &#123;</span></span><br><span class="line"><span class="string">        "enabled": true,</span></span><br><span class="line"><span class="string">        "destOverride": [</span></span><br><span class="line"><span class="string">          "http",</span></span><br><span class="line"><span class="string">          "tls"</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      "streamSettings": &#123;</span></span><br><span class="line"><span class="string">        "sockopt": &#123;</span></span><br><span class="line"><span class="string">          "tproxy": "tproxy"</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  "outbounds": [</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      "tag": "proxy",</span></span><br><span class="line"><span class="string">      "protocol": "vmess",</span></span><br><span class="line"><span class="string">      "settings": &#123;</span></span><br><span class="line"><span class="string">        "vnext": [</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      "streamSettings": &#123;</span></span><br><span class="line"><span class="string">        "sockopt": &#123;</span></span><br><span class="line"><span class="string">          "mark": 255</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      "tag": "direct",</span></span><br><span class="line"><span class="string">      "protocol": "freedom",</span></span><br><span class="line"><span class="string">      "settings": &#123;</span></span><br><span class="line"><span class="string">        "domainStrategy": "UseIPv4"</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      "streamSettings": &#123;</span></span><br><span class="line"><span class="string">        "sockopt": &#123;</span></span><br><span class="line"><span class="string">          "mark": 255</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;      </span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      "tag": "block",</span></span><br><span class="line"><span class="string">      "protocol": "blackhole",</span></span><br><span class="line"><span class="string">      "settings": &#123;</span></span><br><span class="line"><span class="string">        "response": &#123;</span></span><br><span class="line"><span class="string">          "type": "none"</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      "tag": "dns-out",</span></span><br><span class="line"><span class="string">      "protocol": "dns",</span></span><br><span class="line"><span class="string">      "streamSettings": &#123;</span></span><br><span class="line"><span class="string">        "sockopt": &#123;</span></span><br><span class="line"><span class="string">          "mark": 255</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;  </span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  "dns": &#123;</span></span><br><span class="line"><span class="string">    "servers": [</span></span><br><span class="line"><span class="string">      "8.8.8.8",</span></span><br><span class="line"><span class="string">      "1.1.1.1",</span></span><br><span class="line"><span class="string">      "114.114.114.114",</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "address": "223.5.5.5",</span></span><br><span class="line"><span class="string">        "port": 53,</span></span><br><span class="line"><span class="string">        "domains": [</span></span><br><span class="line"><span class="string">          "geosite:cn",</span></span><br><span class="line"><span class="string">          "ntp.org",</span></span><br><span class="line"><span class="string">          "xbssr.fun",</span></span><br><span class="line"><span class="string">          "domain:zhangyuxi.xyz"</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "routing": &#123;</span></span><br><span class="line"><span class="string">    "domainStrategy": "IPOnDemand",</span></span><br><span class="line"><span class="string">    "rules": [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "type": "field",</span></span><br><span class="line"><span class="string">        "inboundTag": [</span></span><br><span class="line"><span class="string">          "transparent"</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        "port": 53,</span></span><br><span class="line"><span class="string">        "network": "udp",</span></span><br><span class="line"><span class="string">        "outboundTag": "dns-out" </span></span><br><span class="line"><span class="string">      &#125;,    </span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "type": "field",</span></span><br><span class="line"><span class="string">        "inboundTag": [</span></span><br><span class="line"><span class="string">          "transparent"</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        "port": 123,</span></span><br><span class="line"><span class="string">        "network": "udp",</span></span><br><span class="line"><span class="string">        "outboundTag": "direct" </span></span><br><span class="line"><span class="string">      &#125;,    </span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "type": "field", </span></span><br><span class="line"><span class="string">        "ip": [ </span></span><br><span class="line"><span class="string">          "223.5.5.5",</span></span><br><span class="line"><span class="string">          "114.114.114.114"</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        "outboundTag": "direct"</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "type": "field",</span></span><br><span class="line"><span class="string">        "ip": [ </span></span><br><span class="line"><span class="string">          "8.8.8.8",</span></span><br><span class="line"><span class="string">          "1.1.1.1"</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        "outboundTag": "proxy"</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "type": "field", </span></span><br><span class="line"><span class="string">        "domain": [</span></span><br><span class="line"><span class="string">          "geosite:category-ads-all"</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        "outboundTag": "block"</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "type": "field",</span></span><br><span class="line"><span class="string">        "protocol":["bittorrent"], </span></span><br><span class="line"><span class="string">        "outboundTag": "direct"</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "type": "field", </span></span><br><span class="line"><span class="string">        "ip": [</span></span><br><span class="line"><span class="string">          "geoip:private",</span></span><br><span class="line"><span class="string">          "geoip:cn"</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        "outboundTag": "direct"</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        "type": "field", </span></span><br><span class="line"><span class="string">        "domain": [</span></span><br><span class="line"><span class="string">          "geosite:cn",</span></span><br><span class="line"><span class="string">          "xbssr.fun"</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        "outboundTag": "direct"</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">DEFAULT_SUBSCRIBE = <span class="string">'dm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVibTA2TFM1d3JkV3dyZm52bzdsbTcxRVFjSzM2YXVZNllDZndyYzROY0szVG1WMFpteHBlRWhDVDhLM01UQXdNRTNDdCtlcHV1bVhzaUlzSW1Ga1pDSTZJakUxTkM0eE55NHhNaTQ0TlNJc0luQnZjblFpT2pJeU1UQTNMQ0pwWkNJNklqZzVOR0ZtWmpKa0xUQTNNemN0T1RnNE15MHdPR1k1TFdKbU5UVXhaVEZtWm1abE5DSXNJbUZwWkNJNklqQWlMQ0p1WlhRaU9pSjBZM0FpTENKMGVYQmxJam9pYm05dVpTSjkKdm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVibTA2TFM1d3JkV3dyZm52bzdsbTcxRVFjSzM2YXVZNllDZndyYzROc0szVG1WMFpteHBlRWhDVDhLM01UQXdNRTNDdCtlcHV1bVhzaUlzSW1Ga1pDSTZJakUxTkM0eE55NHhNaTQ0TmlJc0luQnZjblFpT2pJeU1UQTNMQ0pwWkNJNklqZzVOR0ZtWmpKa0xUQTNNemN0T1RnNE15MHdPR1k1TFdKbU5UVXhaVEZtWm1abE5DSXNJbUZwWkNJNklqQWlMQ0p1WlhRaU9pSjBZM0FpTENKMGVYQmxJam9pYm05dVpTSjkKdm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVibTA2TFM1d3JkV3dyZm52bzdsbTcxSXdyZnBxNWpwZ0ovQ3R6SXdNY0szVG1WMFpteHBlRWgxYkhWSVFrL0N0ekV3TURCTndyZm5xYnJwbDdJaUxDSmhaR1FpT2lJek9DNHhORGN1TVRZMUxqSXdNU0lzSW5CdmNuUWlPakV5TWpjNUxDSnBaQ0k2SWpnNU5HRm1aakprTFRBM016Y3RPVGc0TXkwd09HWTVMV0ptTlRVeFpURm1abVpsTkNJc0ltRnBaQ0k2SWpBaUxDSnVaWFFpT2lKMFkzQWlMQ0owZVhCbElqb2libTl1WlNKOQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmcHBwbm11SzlOd3JmcHE1anBnSi9DdHpnd3dyZE9aWFJtYkdsNFZGWkNWbWwxVkZaSVMxUld3cmN4TURBd1RjSzM1Nm02NlpleUlpd2lZV1JrSWpvaU5UZ3VNVFV6TGpVdU9EQWlMQ0p3YjNKMElqb3lPRFU0T1N3aWFXUWlPaUk0T1RSaFptWXlaQzB3TnpNM0xUazRPRE10TURobU9TMWlaalUxTVdVeFptWm1aVFFpTENKaGFXUWlPaUl3SWl3aWJtVjBJam9pZEdOd0lpd2lkSGx3WlNJNkltNXZibVVpZlE9PQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmcHBwbm11SzlId3JmcHE1anBnSi9DdHpJek1zSzNUbVYwWm14cGVGUldRc0szTVRBd01FM0N0K1dkaCtpaG9TSXNJbUZrWkNJNklqRXdNeTR4TVRNdU1UVTJMakl6TWlJc0luQnZjblFpT2pJM01qRTVMQ0pwWkNJNklqZzVOR0ZtWmpKa0xUQTNNemN0T1RnNE15MHdPR1k1TFdKbU5UVXhaVEZtWm1abE5DSXNJbUZwWkNJNklqQWlMQ0p1WlhRaU9pSjBZM0FpTENKMGVYQmxJam9pYm05dVpTSjkKdm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVibTA2TFM1d3JkV3dyZnBwcG5tdUs5SHdyZnBxNWpwZ0ovQ3R6RTNOc0szVG1WMFpteHBlRlJXUXNLM01UQXdNRTNDdCtlcHV1bVhzaUlzSW1Ga1pDSTZJakV3TXk0eE1UTXVNVFUyTGpFM05pSXNJbkJ2Y25RaU9qTTNPRGs1TENKcFpDSTZJamc1TkdGbVpqSmtMVEEzTXpjdE9UZzRNeTB3T0dZNUxXSm1OVFV4WlRGbVptWmxOQ0lzSW1GcFpDSTZJakFpTENKdVpYUWlPaUowWTNBaUxDSjBlWEJsSWpvaWJtOXVaU0o5CnZtZXNzOi8vZXlKMklqb2lNaUlzSW5Ceklqb2k1Ym0wNkxTNXdyZFd3cmZsajdEbXViNU53cmZwcTVqcGdKL0N0ekU0TWNLM1RtVjBabXhwZU9XS3FPZVV1K2VXcjhLM01UQXdNRTNDdCtlcHV1bVhzaUlzSW1Ga1pDSTZJall4TGpJeU15NDRNaTR4T0RFaUxDSndiM0owSWpvek16VXdNQ3dpYVdRaU9pSTRPVFJoWm1ZeVpDMHdOek0zTFRrNE9ETXRNRGhtT1MxaVpqVTFNV1V4Wm1abVpUUWlMQ0poYVdRaU9pSXdJaXdpYm1WMElqb2lkR053SWl3aWRIbHdaU0k2SW01dmJtVWlmUT09CnZtZXNzOi8vZXlKMklqb2lNaUlzSW5Ceklqb2k1Ym0wNkxTNXdyZFd3cmZudm83bG03MVBUTUszNmF1WTZZQ2Z3cmN4TURqQ3R6RXdNREJOd3JmbnFicnBsN0lpTENKaFpHUWlPaUk1TVM0eU1qQXVNakF5TGpFd09DSXNJbkJ2Y25RaU9qTXhOalUyTENKcFpDSTZJamc1TkdGbVpqSmtMVEEzTXpjdE9UZzRNeTB3T0dZNUxXSm1OVFV4WlRGbVptWmxOQ0lzSW1GcFpDSTZJakFpTENKdVpYUWlPaUowWTNBaUxDSjBlWEJsSWpvaWJtOXVaU0o5CnZtZXNzOi8vZXlKMklqb2lNaUlzSW5Ceklqb2k1Ym0wNkxTNXdyZFd3cmZudm83bG03MVBUc0szNmF1WTZZQ2Z3cmN4TmpQQ3R6RXdNREJOd3JmbnFicnBsN0lpTENKaFpHUWlPaUl4T0RVdU1UY3hMakV5TVM0eE5qTWlMQ0p3YjNKMElqb3pPRFU0TXl3aWFXUWlPaUk0T1RSaFptWXlaQzB3TnpNM0xUazRPRE10TURobU9TMWlaalUxTVdVeFptWm1aVFFpTENKaGFXUWlPaUl3SWl3aWJtVjBJam9pZEdOd0lpd2lkSGx3WlNJNkltNXZibVVpZlE9PQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbnZvN2xtNzFQU3NLMzZhdVk2WUNmd3JjeE16WEN0ekV3TURCTndyZm5xYnJwbDdJaUxDSmhaR1FpT2lJME5TNHhORFF1TWpRd0xqRXpOU0lzSW5CdmNuUWlPakV3T1RneUxDSnBaQ0k2SWpnNU5HRm1aakprTFRBM016Y3RPVGc0TXkwd09HWTVMV0ptTlRVeFpURm1abVpsTkNJc0ltRnBaQ0k2SWpBaUxDSnVaWFFpT2lKMFkzQWlMQ0owZVhCbElqb2libTl1WlNKOQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbnZvN2xtNzFOd3JmcHE1anBnSi9DdHpFd004SzNOVEF3VGNLMzU2bTY2WmV5SWl3aVlXUmtJam9pTVRBekxqRTVOaTR5TWk0eE1ETWlMQ0p3YjNKMElqbzBNRGsyTnl3aWFXUWlPaUk0T1RSaFptWXlaQzB3TnpNM0xUazRPRE10TURobU9TMWlaalUxTVdVeFptWm1aVFFpTENKaGFXUWlPaUl3SWl3aWJtVjBJam9pZEdOd0lpd2lkSGx3WlNJNkltNXZibVVpZlE9PQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbnZvN2xtNzFDd3JmcHE1anBnSi9DdHpZMXdyY3hNREF3VGNLMzU2bTY2WmV5SWl3aVlXUmtJam9pTmpjdU1qTXdMakU0T1M0Mk5TSXNJbkJ2Y25RaU9qTTVPRGt6TENKcFpDSTZJamc1TkdGbVpqSmtMVEEzTXpjdE9UZzRNeTB3T0dZNUxXSm1OVFV4WlRGbVptWmxOQ0lzSW1GcFpDSTZJakFpTENKdVpYUWlPaUowWTNBaUxDSjBlWEJsSWpvaWJtOXVaU0o5CnZtZXNzOi8vZXlKMklqb2lNaUlzSW5Ceklqb2k1Ym0wNkxTNXdyZFd3cmZudm83bG03MUhRY0szNmF1WTZZQ2Z3cmMxTU1LM01UQXdNRTNDdCtlcHV1bVhzaUlzSW1Ga1pDSTZJak00TGpFME15NDRMalV3SWl3aWNHOXlkQ0k2TXpFME5ESXNJbWxrSWpvaU9EazBZV1ptTW1RdE1EY3pOeTA1T0RnekxUQTRaamt0WW1ZMU5URmxNV1ptWm1VMElpd2lZV2xrSWpvaU1DSXNJbTVsZENJNkluUmpjQ0lzSW5SNWNHVWlPaUp1YjI1bEluMD0Kdm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVibTA2TFM1d3JkV3dyZm52bzdsbTcxV3dyZnBxNWpwZ0ovQ3R6RXlNY0szTVRBd01FM0N0K2VwdXVtWHNpSXNJbUZrWkNJNklqRTBOQzR5TURJdU56Y3VNVEl4SWl3aWNHOXlkQ0k2TWpFd01EQXNJbWxrSWpvaU9EazBZV1ptTW1RdE1EY3pOeTA1T0RnekxUQTRaamt0WW1ZMU5URmxNV1ptWm1VMElpd2lZV2xrSWpvaU1DSXNJbTVsZENJNkluUmpjQ0lzSW5SNWNHVWlPaUp1YjI1bEluMD0Kdm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVibTA2TFM1d3JkV3dyZm1sNlhtbkt4UHdyZnBxNWpwZ0ovQ3R6VTJ3cmN4TURBd1RjSzM1Nm02NlpleUlpd2lZV1JrSWpvaU9USXVNVEU0TGpRMUxqVTJJaXdpY0c5eWRDSTZNelUwT1Rjc0ltbGtJam9pT0RrMFlXWm1NbVF0TURjek55MDVPRGd6TFRBNFpqa3RZbVkxTlRGbE1XWm1abVUwSWl3aVlXbGtJam9pTUNJc0ltNWxkQ0k2SW5SamNDSXNJblI1Y0dVaU9pSnViMjVsSW4wPQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbWw2WG1uS3hQd3JmcHE1anBnSi9DdHpFM05NSzNNVEF3TUUzQ3QrZXB1dW1Yc2lJc0ltRmtaQ0k2SWpRMUxqa3pMakl4Tmk0eE56UWlMQ0p3YjNKMElqb3hORFF5TUN3aWFXUWlPaUk0T1RSaFptWXlaQzB3TnpNM0xUazRPRE10TURobU9TMWlaalUxTVdVeFptWm1aVFFpTENKaGFXUWlPaUl3SWl3aWJtVjBJam9pZEdOd0lpd2lkSGx3WlNJNkltNXZibVVpZlE9PQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbWw2WG1uS3hQd3JmcHE1anBnSi9DdHpJd01jSzNNVEF3TUUzQ3QrV2RoK2lob1NJc0ltRmtaQ0k2SWpnNUxqTXhMakV5Tmk0eU1ERWlMQ0p3YjNKMElqb3lNRGMwTWl3aWFXUWlPaUk0T1RSaFptWXlaQzB3TnpNM0xUazRPRE10TURobU9TMWlaalUxTVdVeFptWm1aVFFpTENKaGFXUWlPaUl3SWl3aWJtVjBJam9pZEdOd0lpd2lkSGx3WlNJNkltNXZibVVpZlE9PQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbWw2WG1uS3hQd3JmcHE1anBnSi9DdHpJd044SzNNVEF3TUUzQ3QrZUlodWE3b1NJc0ltRmtaQ0k2SWpnNUxqTXhMakV5Tmk0eU1EY2lMQ0p3YjNKMElqb3hOemt6TlN3aWFXUWlPaUk0T1RSaFptWXlaQzB3TnpNM0xUazRPRE10TURobU9TMWlaalUxTVdVeFptWm1aVFFpTENKaGFXUWlPaUl3SWl3aWJtVjBJam9pZEdOd0lpd2lkSGx3WlNJNkltNXZibVVpZlE9PQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbWxyRGxpcURsbmFGUHdyZnBxNWpwZ0ovQ3R6RXhNc0szTVRBd01FM0N0K2VwdXVtWHNpSXNJbUZrWkNJNklqUTFMalkzTGpVMExqRXhNaUlzSW5CdmNuUWlPalEzTURJeUxDSnBaQ0k2SWpnNU5HRm1aakprTFRBM016Y3RPVGc0TXkwd09HWTVMV0ptTlRVeFpURm1abVpsTkNJc0ltRnBaQ0k2SWpBaUxDSnVaWFFpT2lKMFkzQWlMQ0owZVhCbElqb2libTl1WlNKOQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbnZvN2xtNzFJd3JmbGpwL25sSi9DdHpJek1zSzNNVEF3TUUzQ3QrZXB1dW1Yc2lJc0ltRmtaQ0k2SWpZMExqY3hMakUwTWk0eU16SWlMQ0p3YjNKMElqb3lOVGc0TUN3aWFXUWlPaUk0T1RSaFptWXlaQzB3TnpNM0xUazRPRE10TURobU9TMWlaalUxTVdVeFptWm1aVFFpTENKaGFXUWlPaUl3SWl3aWJtVjBJam9pZEdOd0lpd2lkSGx3WlNJNkltNXZibVVpZlE9PQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbWw2WG1uS3hEd3JmbGpwL25sSi9DdHpJeU5zSzNNakF3VGNLMzU2bTY2WmV5SWl3aVlXUmtJam9pTVRFNExqSTNMakl3TGpJeU5pSXNJbkJ2Y25RaU9qTXlOakUyTENKcFpDSTZJamc1TkdGbVpqSmtMVEEzTXpjdE9UZzRNeTB3T0dZNUxXSm1OVFV4WlRGbVptWmxOQ0lzSW1GcFpDSTZJakFpTENKdVpYUWlPaUowWTNBaUxDSjBlWEJsSWpvaWJtOXVaU0o5CnZtZXNzOi8vZXlKMklqb2lNaUlzSW5Ceklqb2k1Ym0wNkxTNXdyZFd3cmZtbDZYbW5LeER3cmZsanAvbmxKL0N0elExd3JjeU1EQk53cmZucWJycGw3SWlMQ0poWkdRaU9pSXhNVGd1TWpjdU1UY3VORFVpTENKd2IzSjBJam95TkRnME1pd2lhV1FpT2lJNE9UUmhabVl5WkMwd056TTNMVGs0T0RNdE1EaG1PUzFpWmpVMU1XVXhabVptWlRRaUxDSmhhV1FpT2lJd0lpd2libVYwSWpvaWRHTndJaXdpZEhsd1pTSTZJbTV2Ym1VaWZRPT0Kdm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVibTA2TFM1d3JkV3dyZm1sNlhtbkt4RHdyZmxqcC9ubEovQ3R6RTJNY0szTWpBd1RjSzM1Nm02NlpleUlpd2lZV1JrSWpvaU1URTRMakkzTGpRdU1UWXhJaXdpY0c5eWRDSTZOakV5TVRBc0ltbGtJam9pT0RrMFlXWm1NbVF0TURjek55MDVPRGd6TFRBNFpqa3RZbVkxTlRGbE1XWm1abVUwSWl3aVlXbGtJam9pTUNJc0ltNWxkQ0k2SW5SamNDSXNJblI1Y0dVaU9pSnViMjVsSW4wPQp2bWVzczovL2V5SjJJam9pTWlJc0luQnpJam9pNWJtMDZMUzV3cmRXd3JmbXM2TGxoYkJIVE1LM01qWEN0ekl3TUUzQ3QrZXB1dW1Yc2lJc0ltRmtaQ0k2SWpVdU1UZzRMakV3T0M0eU5TSXNJbkJ2Y25RaU9qRTROelF4TENKcFpDSTZJamc1TkdGbVpqSmtMVEEzTXpjdE9UZzRNeTB3T0dZNUxXSm1OVFV4WlRGbVptWmxOQ0lzSW1GcFpDSTZJakFpTENKdVpYUWlPaUowWTNBaUxDSjBlWEJsSWpvaWJtOXVaU0o5CnZtZXNzOi8vZXlKMklqb2lNaUlzSW5Ceklqb2k1WXlGNXB5SXdyZFd3cmZtbDZYbW5LeFB3cmN5Tk1LM01UQXdNRTNDdCtlcHV1bVhzaUlzSW1Ga1pDSTZJamc1TGpNeExqRXlOaTR5TkNJc0luQnZjblFpT2pNd01UYzJMQ0pwWkNJNklqZzVOR0ZtWmpKa0xUQTNNemN0T1RnNE15MHdPR1k1TFdKbU5UVXhaVEZtWm1abE5DSXNJbUZwWkNJNklqQWlMQ0p1WlhRaU9pSjBZM0FpTENKMGVYQmxJam9pYm05dVpTSjkKdm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVZeUY1cHlJd3JkV3dyZm52bzdsbTcxUFRNSzNPREhDdHpFd01EQk53cmZucWJycGw3SWlMQ0poWkdRaU9pSTBOUzR4TkRZdU1USXlMamd4SWl3aWNHOXlkQ0k2TkRrek5qRXNJbWxrSWpvaU9EazBZV1ptTW1RdE1EY3pOeTA1T0RnekxUQTRaamt0WW1ZMU5URmxNV1ptWm1VMElpd2lZV2xrSWpvaU1DSXNJbTVsZENJNkluUmpjQ0lzSW5SNWNHVWlPaUp1YjI1bEluMD0Kdm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVZV042TFM1d3JkV3dyZm1sNlhtbkt4UHdyY3hNVFBDdHpFd01EQk53cmZuaUlibXU2RWlMQ0poWkdRaU9pSTBOUzQyTnk0MU15NHhNVE1pTENKd2IzSjBJam94TkRjeU1Td2lhV1FpT2lJNE9UUmhabVl5WkMwd056TTNMVGs0T0RNdE1EaG1PUzFpWmpVMU1XVXhabVptWlRRaUxDSmhhV1FpT2lJd0lpd2libVYwSWpvaWRHTndJaXdpZEhsd1pTSTZJbTV2Ym1VaWZRPT0Kdm1lc3M6Ly9leUoySWpvaU1pSXNJbkJ6SWpvaTVZV042TFM1d3JkV3dyZm52bzdsbTcxUFRzSzNORFhDdHpFd01EQk53cmZuaUlibXU2RWlMQ0poWkdRaU9pSXhORGN1TnpndU1UVXVORFVpTENKd2IzSjBJam96T0RZNU1Td2lhV1FpT2lJNE9UUmhabVl5WkMwd056TTNMVGs0T0RNdE1EaG1PUzFpWmpVMU1XVXhabVptWlRRaUxDSmhhV1FpT2lJd0lpd2libVYwSWpvaWRHTndJaXdpZEhsd1pTSTZJbTV2Ym1VaWZRPT0Kc3NyOi8vYkRJNk1UcHZjbWxuYVc0NlkyaGhZMmhoTWpBNmNHeGhhVzQ2WWtSSkx6OXlaVzFoY210elBVeFRNSFJNVXpCMFRGTXdkRXhUTUhSTVV6QjBURk13ZEV4VE1IUk1VekIwVEZNd2RFeFJKbWR5YjNWd1BUWkxWMTgyV1U5dk5VeHBWelUxVjAxV2JFSlAKc3NyOi8vZG1sd09qRTZiM0pwWjJsdU9tTm9ZV05vWVRJd09uQnNZV2x1T21SdGJIY3ZQM0psYldGeWEzTTlOVmx0Y0RWTU1scFBhVUY0VFZSVk5EVmhVM0JQVDFkM2FpMWhXSFJxV0d4cFNXSndhM0E0WjBsRFFXZEpRMEZuU1VOQlowbERRV2RKUVNabmNtOTFjRDAyUzFkZk5sbFBielZNYVZjMU5WZE5WbXhDVHcKc3NyOi8vTVdJMk1Ub3hPbTl5YVdkcGJqcGphR0ZqYUdFeU1EcHdiR0ZwYmpwTlYwa3lUVkV2UDNKbGJXRnlhM005TldFMldUVTNNbEpQYVVKdlpFaFNkMk42YjNaTU0yaHBZekp2TWsxVVVUUk1ibWcxWldrNEptZHliM1Z3UFRaTFYxODJXVTl2TlV4cFZ6VTFWMDFXYkVKUA'</span></span><br><span class="line"></span><br><span class="line">logger = logging.getLogger()</span><br><span class="line">logger.setLevel(level = logging.INFO)</span><br><span class="line">formatter = colorlog.ColoredFormatter(<span class="string">'%(log_color)s%(asctime)s [%(levelname)s] %(message)s'</span>)</span><br><span class="line"><span class="comment"># when设置为: 周(W),天(D),时(H),分(M),秒(S) MIDNIGHT代表0点就新建日志 代表多久分割一个文件</span></span><br><span class="line"><span class="comment"># backupCount: 代表备份的日志个数</span></span><br><span class="line">th = handlers.TimedRotatingFileHandler(filename=LOG_FILE, when=<span class="string">'MIDNIGHT'</span>, backupCount=<span class="number">3</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">sh = logging.StreamHandler()</span><br><span class="line">th.setFormatter(formatter)</span><br><span class="line">sh.setFormatter(formatter)</span><br><span class="line">logger.addHandler(th)</span><br><span class="line">logger.addHandler(sh)</span><br><span class="line"></span><br><span class="line">debug = logging.debug</span><br><span class="line">info = logging.info</span><br><span class="line">warning = logging.warning</span><br><span class="line">error = logging.error</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_base64</span><span class="params">(data)</span>:</span></span><br><span class="line">    missing_padding = <span class="number">4</span>-len(data)%<span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> missing_padding:</span><br><span class="line">        data += <span class="string">'='</span>*missing_padding</span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_port</span><span class="params">()</span>:</span></span><br><span class="line">    pscmd = <span class="string">"netstat -ntl |grep -v Active| grep -v Proto|awk '&#123;print $4&#125;'|awk -F: '&#123;print $NF&#125;'"</span></span><br><span class="line">    procs = os.popen(pscmd).read()</span><br><span class="line">    procarr = procs.split(<span class="string">"\n"</span>)</span><br><span class="line">    tt= random.randint(<span class="number">15000</span>,<span class="number">20000</span>)</span><br><span class="line">    <span class="keyword">if</span> tt <span class="keyword">not</span> <span class="keyword">in</span> procarr:</span><br><span class="line">        <span class="keyword">return</span> tt</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        get_port()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_factor</span><span class="params">(perfect, latency)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> perfect*PERFECT_FACTOR + latency*LATENCY_FACTOR</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_latency</span><span class="params">(port)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.79 Safari/537.36'</span>&#125;</span><br><span class="line">    proxies = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> port != <span class="number">0</span>:</span><br><span class="line">      proxies[<span class="string">'http'</span>] = <span class="string">'socks5h://127.0.0.1:&#123;&#125;'</span>.format(port)</span><br><span class="line">      proxies[<span class="string">'https'</span>] = <span class="string">'socks5h://127.0.0.1:&#123;&#125;'</span>.format(port)</span><br><span class="line"></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    s = requests.Session()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s.mount(TEST_CONNECT_URL, HTTPAdapter(max_retries=<span class="number">0</span>))</span><br><span class="line">        r = s.get(TEST_CONNECT_URL, proxies=proxies, headers=headers, verify=<span class="literal">True</span>, timeout=(TEST_CONNECT_TIMEOUT,TEST_READ_TIMEOUT), allow_redirects=<span class="literal">False</span>, cookies=&#123;<span class="string">''</span>:<span class="string">''</span>&#125;)</span><br><span class="line">        r.raise_for_status()</span><br><span class="line">        connectivity = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">        warning(<span class="string">'test connect error port:&#123;&#125;, message:&#123;&#125;'</span>.format(port, err))</span><br><span class="line">        connectivity = <span class="literal">False</span></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    </span><br><span class="line">    latency_time = end_time - start_time</span><br><span class="line">    <span class="keyword">return</span> latency_time, connectivity</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 总共测试TEST_CONNECT_TIMES次, perfect是连接失败的次数, latency是平均延迟</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_connect</span><span class="params">(port)</span>:</span></span><br><span class="line">    perfect = TEST_CONNECT_TIMES</span><br><span class="line">    sum_r = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(TEST_CONNECT_TIMES):</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        r, p = get_latency(port)</span><br><span class="line">        <span class="keyword">if</span> p <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">            sum_r += r</span><br><span class="line">            perfect -= <span class="number">1</span></span><br><span class="line">            info(<span class="string">'test connect port:&#123;&#125;, latency_time:&#123;&#125;'</span>.format(port, r))</span><br><span class="line">    <span class="keyword">if</span> perfect != TEST_CONNECT_TIMES:</span><br><span class="line">        times = TEST_CONNECT_TIMES - int(perfect)</span><br><span class="line">        s = sum_r / times</span><br><span class="line">        latency = float(format(s, <span class="string">'0.2f'</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        latency = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> perfect, latency</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从订阅地址读取信息,返回主机列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_subscribe</span><span class="params">()</span>:</span></span><br><span class="line">    info(<span class="string">'start getting subscription'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(SUBSCRIBE_RETRY_MAX):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(SUBSCRIBE_URL, timeout=SUBSCRIBE_TIMEOUT)</span><br><span class="line">            info(<span class="string">'get subscription successfully'</span>)</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            error(<span class="string">'get subscription failed, error message:&#123;&#125;'</span>.format(err))</span><br><span class="line">            <span class="keyword">if</span> i == SUBSCRIBE_RETRY_MAX<span class="number">-1</span>:</span><br><span class="line">                error(<span class="string">'reach the maximum number of subscription retries'</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理从网络上获取的订阅信息</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_subscribe</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        base64_server_list = str(decode_base64(text), encoding=<span class="string">'utf8'</span>).split(<span class="string">'\n'</span>)</span><br><span class="line">        server_list = []</span><br><span class="line">        <span class="keyword">for</span> server <span class="keyword">in</span> base64_server_list:</span><br><span class="line">            protocol, server_info = server.split(<span class="string">'://'</span>)</span><br><span class="line">            <span class="keyword">if</span> protocol == <span class="string">'vmess'</span>:</span><br><span class="line">                server_info = json.loads(str(decode_base64(server_info), encoding=<span class="string">'utf8'</span>))</span><br><span class="line">                <span class="keyword">if</span> server_info.get(<span class="string">'add'</span>) <span class="keyword">and</span> server_info.get(<span class="string">'port'</span>) <span class="keyword">and</span> server_info.get(<span class="string">'id'</span>) <span class="keyword">and</span> server_info.get(<span class="string">'aid'</span>) <span class="keyword">and</span> server_info.get(<span class="string">'ps'</span>):</span><br><span class="line">                    real_server_info = &#123;<span class="string">'ps'</span>:server_info[<span class="string">'ps'</span>],<span class="string">'address'</span>:server_info[<span class="string">'add'</span>],<span class="string">'port'</span>:server_info[<span class="string">'port'</span>],<span class="string">'users'</span>:[&#123;<span class="string">'id'</span>:server_info[<span class="string">'id'</span>], <span class="string">'alterId'</span>:int(server_info[<span class="string">'aid'</span>])&#125;]&#125;</span><br><span class="line">                    server_list.append(real_server_info)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">        error(<span class="string">'parse subscription failure'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    info(<span class="string">'parse subscription successfully'</span>)</span><br><span class="line">    <span class="keyword">return</span> server_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入服务器信息,生成一个配置文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_config_file</span><span class="params">(server)</span>:</span></span><br><span class="line">    tmp_name = uuid.uuid4().hex+<span class="string">'.json'</span></span><br><span class="line">    port = get_port()</span><br><span class="line">    tmp_json = json.loads(TMP_CONFIG_FILE)</span><br><span class="line">    tmp_json[<span class="string">'outbounds'</span>][<span class="number">0</span>][<span class="string">'settings'</span>][<span class="string">'vnext'</span>].append(server)</span><br><span class="line">    tmp_json[<span class="string">'inbounds'</span>][<span class="number">0</span>][<span class="string">'port'</span>] = port</span><br><span class="line">    <span class="keyword">with</span> open(tmp_name, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(tmp_json, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>))</span><br><span class="line">    info(<span class="string">'generate config file, tmp_name:&#123;&#125;, address:&#123;&#125;, port:&#123;&#125;, server name:&#123;&#125;'</span>.format(tmp_name, server[<span class="string">'address'</span>], port, server[<span class="string">'ps'</span>]))</span><br><span class="line">    <span class="keyword">return</span> tmp_name, port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_v2ray</span><span class="params">(server)</span>:</span></span><br><span class="line">    tmp_name, port = generate_config_file(server)</span><br><span class="line">    info(<span class="string">'run v2ray, tmp_name:&#123;&#125;, port:&#123;&#125;'</span>.format(tmp_name, port))</span><br><span class="line">    cmd = [V2RAY_PATH, <span class="string">'-config'</span>, tmp_name]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = subprocess.Popen(cmd, shell=<span class="literal">False</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.DEVNULL)</span><br><span class="line">        time.sleep(<span class="number">0.8</span>)</span><br><span class="line">        perfect, latency = test_connect(port)</span><br><span class="line">        p.kill()</span><br><span class="line">        os.remove(tmp_name)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line">    info(<span class="string">'test connection finished, address:&#123;&#125;, port:&#123;&#125;, server name:&#123;&#125;, perfect:&#123;&#125;, latency:&#123;&#125;'</span>.format(server[<span class="string">'address'</span>], server[<span class="string">'port'</span>], server[<span class="string">'ps'</span>], perfect, latency))</span><br><span class="line">    <span class="keyword">return</span> server, perfect, latency</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_best_server</span><span class="params">(best_server)</span>:</span></span><br><span class="line">    final_json = json.loads(FINAL_CONFIG_FILE)</span><br><span class="line">    final_json[<span class="string">'outbounds'</span>][<span class="number">0</span>][<span class="string">'settings'</span>][<span class="string">'vnext'</span>].append(best_server)</span><br><span class="line">    <span class="keyword">with</span> open(V2RAY_CONIG_FILE, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(final_json, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restart_v2ray</span><span class="params">()</span>:</span></span><br><span class="line">    subprocess.Popen([<span class="string">'sudo'</span>, <span class="string">'systemctl'</span>, <span class="string">'restart'</span>, <span class="string">'v2ray'</span>], shell=<span class="literal">False</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.DEVNULL)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reset_v2ray</span><span class="params">(server_list)</span>:</span></span><br><span class="line">    proc = multiprocessing.Pool(MAX_SERVER)</span><br><span class="line">    proc_result = []</span><br><span class="line">    <span class="keyword">for</span> server <span class="keyword">in</span> server_list:</span><br><span class="line">        r = proc.apply_async(run_v2ray, args=(server,))</span><br><span class="line">        proc_result.append(r)</span><br><span class="line">    proc.close()</span><br><span class="line">    proc.join()</span><br><span class="line"></span><br><span class="line">    server_factor_list = []</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> proc_result:</span><br><span class="line">        server, perfect, latency = r.get()</span><br><span class="line">        factor = compute_factor(perfect, latency)</span><br><span class="line">        server_factor_list.append([server, factor])</span><br><span class="line">    server_factor_sorted_list = sorted(server_factor_list, key=<span class="keyword">lambda</span> s:s[<span class="number">1</span>])</span><br><span class="line">    server_sorted_list = list(map(<span class="keyword">lambda</span> s:s[<span class="number">0</span>], server_factor_sorted_list))</span><br><span class="line">    best_server = server_sorted_list[<span class="number">0</span>]</span><br><span class="line">    info(<span class="string">'find best server, best factor:&#123;&#125;, best_server:&#123;&#125;'</span>.format(server_factor_sorted_list[<span class="number">0</span>][<span class="number">1</span>], best_server))</span><br><span class="line">    write_best_server(best_server)</span><br><span class="line">    restart_v2ray()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    server_list = []</span><br><span class="line">    last_get_subscribe = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">        info(<span class="string">'start testing current connection'</span>)</span><br><span class="line">        latency_time, connectivity = get_latency(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> connectivity <span class="keyword">and</span> latency_time &lt; CHECK_LIMIT:</span><br><span class="line">            info(<span class="string">'connectivity is true, latency_time:&#123;&#125;, wait TIME_INTERVAL(&#123;&#125;) seconds'</span>.format(latency_time, TIME_INTERVAL))</span><br><span class="line">            time.sleep(TIME_INTERVAL)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        warning(<span class="string">'connectivity is false, start testing current server'</span>)</span><br><span class="line">        perfect, latency = test_connect(<span class="number">0</span>)</span><br><span class="line">        factor = compute_factor(perfect, latency)</span><br><span class="line">        info(<span class="string">'factor: &#123;&#125;'</span>.format(factor))</span><br><span class="line">        <span class="keyword">if</span> factor &gt; RESET_FACTOR_LIMIT:</span><br><span class="line">            warning(<span class="string">'factor is bigger than RESET_FACTOR_LIMIT(&#123;&#125;), start finding a best server and reseting v2ray'</span>.format(RESET_FACTOR_LIMIT))</span><br><span class="line">            <span class="keyword">if</span> time.time() - last_get_subscribe &gt; SUBSCRIBE_CACHE_TIME:</span><br><span class="line">                server_info = get_subscribe()</span><br><span class="line">                <span class="keyword">if</span> server_info:</span><br><span class="line">                    last_get_subscribe = time.time()</span><br><span class="line">                <span class="keyword">elif</span> last_get_subscribe == <span class="number">0</span>:</span><br><span class="line">                    server_info = DEFAULT_SUBSCRIBE</span><br><span class="line">                    warning(<span class="string">'get subscription failed, try to use default subprocess'</span>)</span><br><span class="line">                <span class="keyword">if</span> server_info:</span><br><span class="line">                    tmp_server_list = parse_subscribe(server_info)</span><br><span class="line">                    <span class="keyword">if</span> tmp_server_list:</span><br><span class="line">                        server_list = tmp_server_list</span><br><span class="line">            <span class="keyword">if</span> len(server_list) != <span class="number">0</span>:</span><br><span class="line">                reset_v2ray(server_list)</span><br><span class="line">                info(<span class="string">'set new best server successfully, start waiting for new round, wait TIME_INTERVAL(&#123;&#125;) seconds'</span>.format(TIME_INTERVAL))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                error(<span class="string">'no server available, start waiting for new round, wait TIME_INTERVAL(&#123;&#125;) seconds'</span>.format(TIME_INTERVAL))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            info(<span class="string">'factor is less than or equal to RESET_FACTOR_LIMIT(&#123;&#125;), wait TIME_INTERVAL(&#123;&#125;) seconds'</span>.format(RESET_FACTOR_LIMIT, TIME_INTERVAL))</span><br><span class="line">        time.sleep(TIME_INTERVAL)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure></p>
<h5 id="使用systemd配置开机启动"><a href="#使用systemd配置开机启动" class="headerlink" title="使用systemd配置开机启动"></a>使用systemd配置开机启动</h5><ol>
<li>创建<code>/lib/systemd/system/v2ray_auto_change.service</code>文件<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /lib/systemd/system/v2ray_auto_change.service</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>写入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=V2ray Auto Change Service</span><br><span class="line">After=multi-user.target</span><br><span class="line">Conflicts=getty@tty1.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/python3 /usr/bin/v2ray_auto_change</span><br><span class="line">StandardInput=tty-force</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li><p>重新加载<code>systemctl daemon</code>,<code>.service</code>文件每次修改后都要重新加载</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动v2ray_auto_change</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> v2ray_auto_change.service</span><br><span class="line">sudo systemctl start v2ray_auto_change.service</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="一键配置系统脚本"><a href="#一键配置系统脚本" class="headerlink" title="一键配置系统脚本"></a>一键配置系统脚本</h2><p>首先在本地克隆自动配置项目<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:Evolution404/pi_autoconfig.git</span><br></pre></td></tr></table></figure></p>
<p>将整个项目文件夹复制到树莓派里<br>执行项目里的config.sh开始一键配置,后面需要传入pi用户的新密码和smb服务器的密码<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> pi_autoconfig</span><br><span class="line">sudo bash config.sh pi_pw smb_pw</span><br></pre></td></tr></table></figure></p>
</div></article><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/08/16/docker/docker基础/"><i class="fa fa-chevron-left">  </i><span>docker基础</span></a></div><div class="next-post pull-right"><a href="/2019/11/17/Linux/makefile编写规则/"><span>makefile编写规则</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span>评论</span></div><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'6gtOwA2GHt58meLiqVoE8cet-gzGzoHsz',
  appKey:'QpeNYt9Rb5S95BmN3fgBuRmi',
  placeholder:'留下你的足迹吧',
  avatar:'mp',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div></div><footer class="footer-bg" style="background-image: url(https://evolution404.gitee.io/markdownimg/20190513125446.png)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By zhang Yuxi</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-comments-o" id="to_comment"></i><i class="fa nightshift fa-moon-o" id="nightshift"></i></section><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/js.cookie.js"></script><script src="/js/search/local-search.js"></script><script src="/js/pace/pace.min.js"></script><script src="/js/nightshift/nightshift.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}
$("#to_comment").on("click", function() {
  var t = $("#post-comment").offset();
  $("body,html").animate({
    scrollTop: t.top
  })
})</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>